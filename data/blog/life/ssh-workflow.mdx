---
title: 'SSH Workflow'
date: '2024-02-21T00:00:00-0800'
tags: ['programming']
draft: false
summary: 'Efficient workflow through SSH.'
layout: PostLayout
---

# SSH Workflow

The current tools I have available to me at work are as follows:

1. Windows laptop
2. Repos hosted on Github
3. Workstations/Servers to do development work on

What is the most efficient way to do software development with these tools?

## SSH Keys

### Generation

```bash
ssh-keygen -t ed25519 -C "@gmail.com"
# Usually spam enter for defaults is ok
```

Note that improved algorithms may be introduced. Check the source for most update-to-date algorithms.

[Source](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent)

### Adding to Github Account

[Add to Github account](https://github.com/settings/keys)

[Source](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account)

### SSH Connection

Populate `~/.ssh/config` with information, an example can be as follows

```
Host nickname
  HostName 11.111.11.11
  User kerrywang
  ForwardAgent yes
  Identifyfile ~/.ssh/id_ecdsa
  ProxyJump loginnode

Host loginnode
  HostName 11.111.11.12
  User kerrywang
  ForwardAgent yes
  Identifyfile ~/.ssh/id_ecdsa
```

### Copying SSH key to Servers

This allows you to directly `ssh hostname` without needing extraneous authentication.

`ssh-copy-id username@remote-host-name-or-ip`

[Source](https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server)

Then use `ssh nickname` to ssh into a remote server, while also keeping an agent alive that allows you to interact with a Github repo.

### Auto SSH agent

Add following to your `.bash_profile` (haven't tested long term yet).

```bash
SSH_ENV="$HOME/.ssh/agent-environment"

function start_agent {
    echo "Initialising new SSH agent..."
    /usr/bin/ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
    echo succeeded
    chmod 600 "${SSH_ENV}"
    . "${SSH_ENV}" > /dev/null
    /usr/bin/ssh-add;
}

# Source SSH settings, if applicable

if [ -f "${SSH_ENV}" ]; then
    . "${SSH_ENV}" > /dev/null
    #ps ${SSH_AGENT_PID} doesn't work under cywgin
    ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
        start_agent;
    }
else
    start_agent;
fi
```

[Source](https://stackoverflow.com/a/18915067)

## Development

### Shell Utility Function

A shell utilty function that combines an ssh and `cd`ing into a directory can be done as follows

```bash
sshh() {
    ssh -t $1 cd ${2:-/path/to/default/dir/} ';' exec /bin/bash
}
```

### Text Editing

I like VSCode (+ Vim bindings) as my text editor.

I use the [`Remote - SSH`](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh) extension to attach a VSCode window to a remote SSH. Use `>Remote-SSH: Connect Current Window to Host` in VSCode.

### Docker Containers

I use the [`Dev Containers`](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers) to mount a running container to my VSCode window. This allows the full intellisense, etc. tools to work perfectly, as-if I were working locally on that server. Use `>Dev Containers: Attach to Running Container` in VSCode.

To configure default user, workspace directory, etc., use `>Dev Containers: Open Attached Container Configuration File` in VSCode, which opens a JSON file, where you can add

```json
{
  ...
	"workspaceFolder": "/data",
	"remoteUser": "username"
}
```
